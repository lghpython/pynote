vi/vim操作命令

### 打开文件 vim [option] file

- +2 直接定位到第二行
- +/pattern 打开文件后,直接定位到第一个匹配的
- -b 二进制方式打开
- -d f1 f2 对比打开多个文件
- -m 只读方式打开文件

### 模式

- 命令模式: 移动光标、粘贴复制文本
- 插入模式/编辑模式:修改文本
- 末行模式(扩展命令模式):保存退出

#### 模式切换

- 命令模式---> 插入模式
  - i键 进入
  - I键 光标跳转行首
  - a键光标所在后面插入(默认光标位置插入)
  - A键 光标跳转行末
  - o键 下一行插入
  - O键 上一行插入
- 插入模式 ---> 命令模式 : esc
- 末行模式---> 命令模式
  - esc esc
  - esc enter
- 命令模式--->末行模式
  - :键 进入末行模式

#### 关闭文件

- 末行模式
  - :w 保存
  - :q退出
  - :wq保存并退出
  - :q! 强制对出
  - :wq! 强制保存退出
  - :x 保存并退出
- 命令模式
  - ZZ保存退出
  - ZQ不保存退出

#### 扩展命令行模式

- 按":"来进入
- w写入
- q退出
- wq保存并退出
- q!强制退出
- x 保存并退出
- r file读入文件
- w file 另存为
- !command 直接执行命令
-  r!command 直接把命令的结果写到文件中

#### 命令模式

- 字符间的跳转
  - l 向右
  - h 向左
  - j 向上
  - k向下
- 单词间跳转
  - w 下一次的单词的头部
  - e 当前单词的词尾,或下一单词词尾
  - b 当前单词的刺手或上一单词的词首
  - #command直接跳转#个单词
- 页面间跳转
  - H页首
  - L页尾
  - M 页中
  - zt 当前行移动到首行
  - zb 当前行移动到末行
- 行首行尾跳转
  - ^ 跳转当前行第一个非空字符
  - 0 跳转行首
  - $ 跳转行尾
  - #G 跳转到#行
  - G直接到最后一行
  - gg跳转到第一行
- 段落跳转(空行分割)
  - { 跳转上一段
  - } 跳转下一段
- 翻屏
  - ctrl +f 向下翻屏
  - ctrl +b 向上翻屏
  - ctrl +d 向下翻半屏
  - ctrl +u 向上翻半#### 

#### 命令模式编辑

- 字符编辑
  - x删除当前字符
  - #x 删除#个字符
  - xp当前字符与后面互换
  - -大小写互换
  - J删除当前行换行符
- 替换
  - r 替换当前字符
  - R 开启替换模式
- 删除
  - d 删除 和跳转结合 
  - dw删除单词
  - d$ 删除到行末
  - d0 删除到行首
  - d^ 删除到非空字符
  - de 向后删除单词
  - db向前删除一个单词
  - dd删除整行
  - 3dd 删除3行
  - dG 删除到结尾
  - dgg 删除到开头
  - D 相当于d$
- 复制
  - y 复制 和跳转结合
  - y$ 复制到行末
  - y0 复制到行首
  - y^ 复制到非空字符
  - ye 向后复制单词
  - yb向前复制一个单词
  - yy 复制整行
  - 3yy 复制3行
  - yG 复制到结尾
  - dyy 复制到开头
  - Y 复制整行
- 粘贴
  - p 往后粘贴
  - P 往前粘贴
- 改变 切换插入模式
  - c 修改 和跳转做结合
  - c$ 
  - c0
  - c^
  - cw
  - cb
  - ce
  - #c
  - cc 删除当 前行并插入
  - C 相当于c$
- #[i|I|a|A|o|O]xxx esc 粘贴#次xxx
- 搜索
  - /pattern 往下搜索
  - ?pattern网上搜索
  - n同命令/ ?相同的方向
  - N 同/ ?相反的的方向
- 撤销
  - u 撤销最近的修改
  - #u 撤销
  - U 撤销最近一条修改
  - . 重复最后一次操作
  - #. 重复最后一次操作#次
  - ctrl+r 重做最后一次操作



#### 命令扩展模式

- 地址定界, 配合命令操作
  - : start end 对第start到end行进行操作
  - #, 具体到行数
  - #,+n 从#行开始操作n行
  - $ 倒数第一行
  - $-1  倒数第二行
  - % 表示全文
  - /pat1/,/pat2/ 从匹配pat1 到匹配pat2的文本
  - /pat1/,$. 从第一个匹配pat1到末尾
  - 可以使用的命令:
    - d 删除
    - y 复制
    - p 粘贴
    - r file 文件内容插入后面
    - w file 重新另存为文件

#### 查找并替换

- 查找内容地址定界
- s 在扩展命令下使用为替换
- 格式: %s/查找内容正则/替换内容/
- %s/查找正则分组/#\1/ 引用匹配到的第一个分组内容
  - #\1 分组1
  - #\2 分组2
  - #\\& 表示分组内容
- 装饰器
  - i 忽略大小写
  - g  表示圈住替换
  - gc 询问是否替换
- 分隔符出来/ 还可以
  - @
  - #

### 可视化

- v 面向字符
- V 面向行
- ctrl+v 面向块
- 可以结合所有的跳转键进行结合
- 对突出显示部分可以使用删除、复制、

#### 多个文件

- vim f1 f2 f3
- :next
- :prev
- :first
- :last
- :wqall
- :xall保存并退出全部
- :qall

#### 多个窗口

- vim -o f1 f2 f3 水平同时显示多个文件窗口
- vim -O f1 f2 f3 垂直同时显示多个文件窗口
- ctrl+w+上下左右  切换
- ctrl+w,s 单文件水平切割
- ctrl +w,v 单文件垂直切割
- ctrl+w,q 取消相邻窗口
- ctrl+w,o 取消全部窗口

#### vim工作特性

- 配置文件:

  - 全局生效: /etc/vimrc
  - 当前生效: 当前用户新建 ~/.vimrc

  - 行号 set nu/nonu

  - 忽略大小写 set ic/noic

  - set ai 自动缩进,随上一行

  - 高亮显示搜索结果: set hls/nohls

  - 语法高亮 syntax off/on

  - 文件格式

    -  windows格式: set fileformat=dos

    - unix格式: set fileformat=unix

  - set cul/nocul 标识线

  - set all 获取帮助  

  - vimtutor  / help  / help topic 获取帮助信息